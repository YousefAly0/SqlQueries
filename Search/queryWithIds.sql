USE Do2romStage23112021;
SELECT Count(*) OVER() AS TotalCount, prd.ep_id AS EpId, prd.ep_arabicName AS EpArabicName, prd.ep_englishName AS EpEnglishName, price.markpr_current_price AS Price, img.ep_img_path AS EpImageUrl, 
                            market.market_id AS MarketId, market.market_name AS MarketName, market.market_name_en AS MarketNameEn, market.market_small_image_url AS MarketSmallImageUrl, market.market_small_image_En_url AS MarketSmallImageEnUrl
							
                            FROM excelproducts prd
                            INNER JOIN  (VALUES (7627626,0),(7626595,1),(7639059,2),(7639062,3),(7639112,4),(7624190,5),(7624192,6),(7624273,7),(7624274,8),(7628345,9),(7628347,10),(7629651,11),(7629654,12),(7632326,13),(7640605,14),(7623692,15),(7626551,16),(7626552,17),(7626554,18),(7626555,19),(7637204,20),(7623883,21),(7623884,22),(7623979,23),(7623980,24),(7623981,25),(7623983,26),(7623984,27),(7624034,28),(7624090,29),(7624093,30),(7629386,31),(7631093,32),(7640668,33),(7640669,34),(7640822,35),(7640838,36),(7640985,37),(7641492,38),(7641494,39),(7641512,40),(7623326,41),(7623327,42),(7623329,43),(7623330,44),(7623335,45),(7623325,46),(12047881,47),(12048066,48),(7642057,49),(7642058,50),(7642392,51),(7643908,52),(7645814,53),(7636187,54),(7636420,55),(7636423,56),(7636572,57),(7636584,58),(7636592,59),(7637670,60),(7637674,61),(7637678,62),(7638329,63),(7638333,64),(7638452,65),(7639719,66),(7639794,67),(7623629,68),(7623630,69),(7623631,70),(7623632,71),(7623666,72),(7623815,73),(7623816,74),(7624006,75),(7624007,76),(7627194,77),(7627596,78),(7627601,79),(7627605,80),(7627608,81),(7630317,82),(7630320,83),(7630325,84),(7630537,85),(7631001,86),(7631003,87),(7631571,88),(7633255,89),(7634651,90),(7640671,91),(7640672,92),(7640988,93),(7641496,94),(7623172,95),(12048162,96),(7641887,97),(7641888,98),(7642393,99),(7642396,100),(7642415,101),(7642811,102),(7643647,103),(7643649,104),(7643650,105),(7643652,106),(7646506,107),(12046617,108),(12046668,109),(12046781,110),(12046783,111),(7636589,112),(7637194,113),(7638331,114),(7638348,115),(7638380,116),(7638383,117),(7638401,118),(7638406,119),(7638457,120),(7639972,121),(7623667,122),(7623668,123),(7623817,124),(7624148,125),(7627675,126),(7630424,127),(7631133,128),(7631140,129),(7631181,130),(7631184,131),(7632346,132),(7632488,133),(7632514,134),(7632517,135),(7633247,136),(7634650,137),(7634661,138),(7634664,139),(7641062,140),(7623514,141),(7623515,142),(7632509,143),(12048042,144),(8646583,145),(12046752,146),(12046901,147),(12046902,148),(12047458,149),(12047459,150),(12047460,151),(7637197,152),(7637970,153),(7638014,154),(7638337,155),(7638342,156),(7638343,157),(7638353,158),(7638365,159),(7624008,160),(7624009,161),(7624011,162),(7624012,163),(7625375,164),(7626503,165),(7627537,166),(7627613,167),(7627628,168),(7627632,169),(7630306,170),(7630307,171),(7630605,172),(7630607,173),(7630611,174),(7630613,175),(7632338,176),(7633858,177),(7634033,178),(7634034,179),(7634036,180),(7634419,181),(7634681,182),(7623001,183),(7623002,184),(7642976,185),(7642978,186),(12046897,187),(12046899,188),(12046945,189),(12046947,190),(7635927,191),(7637202,192),(7637649,193),(7638323,194),(7639082,195),(7639119,196),(7639123,197),(7639148,198),(7639161,199),(7639729,200),(7639738,201),(7639941,202),(7640065,203),(7640093,204),(7624299,205),(7625386,206),(7627545,207),(7627640,208),(7628158,209),(7629966,210),(7629967,211),(7629968,212),(7633240,213),(7633253,214),(7633569,215),(7633571,216),(7633801,217),(7633805,218),(7634166,219),(7634667,220),(7634671,221),(7634676,222),(7634678,223),(7634680,224),(7639121,225),(7639124,226),(7642982,227),(7642986,228),(7643940,229),(7643942,230),(12047372,231),(7637990,232),(7638345,233),(7638417,234),(7639125,235),(7639144,236),(7639169,237),(7639173,238),(7639926,239),(7626495,240),(7626510,241),(7626516,242),(7626545,243),(7627249,244),(7632487,245),(7632513,246),(7634654,247),(7634668,248),(7644678,249),(7637681,250),(7637959,251),(7639015,252),(7639016,253),(7625123,254),(7625380,255),(7627259,256),(7630321,257),(7632344,258),(7633517,259),(7633521,260),(7633531,261),(7634618,262),(7634621,263),(12047989,264),(7643933,265),(7644637,266),(7637979,267),(7638006,268),(7626488,269),(7627036,270),(7627037,271),(7627042,272),(7627044,273),(7627046,274),(7627048,275),(7627051,276),(7627060,277),(7627844,278),(7644551,279),(7625378,280),(7625379,281),(7625410,282),(7627056,283),(7627840,284),(7627841,285),(7627843,286),(7628941,287),(7627838,288),(7627839,289)) AS rankTable(id, rank) ON prd.ep_id = rankTable.id
                            INNER JOIN productLines pl3 ON pl3.pl_id  = prd.ep_productLine 
                            INNER JOIN productLines pl2 ON pl2.pl_id = pl3.pl_parent
                            INNER JOIN Item_Type cat3 ON cat3.type_id = pl3.pl_prim_type
                            INNER JOIN Item_type cat2 ON cat2.type_id = cat3.Type_Parent
                            INNER JOIN Item_type cat1 ON cat1.type_id = cat2.Type_Parent
                            INNER JOIN market_products_prices price ON price.markpr_pr_id = prd.ep_id
                            INNER JOIN Market market ON market.market_id = price.markpr_market_id
                            INNER JOIN excelproducts_images img ON img.ep_img_epid = prd.ep_id and img.ep_img_primary = 1
                                and img.ep_img_size = 63
                            INNER JOIN ph.ph_product_Price_hunter phProduct ON phProduct.php_ep_id = prd.ep_id 
                            	and DATEDIFF(DAY, phProduct.php_updated_date, '07/27/2022') < 30 
                            LEFT JOIN Item_Type secCat3 ON secCat3.type_id = pl3.pl_sec_type 
                            LEFT JOIN Item_Type secCat2 ON secCat2.type_id = secCat3.Type_Parent 
                            LEFT JOIN Item_Type secCat1 ON secCat1.type_id = secCat2.Type_Parent 
WHERE 1=1  AND market.market_id = 50 

 ORDER BY rankTable.rank
OFFSET 0 ROWS
                                    FETCH NEXT 1000 ROWS ONLY;